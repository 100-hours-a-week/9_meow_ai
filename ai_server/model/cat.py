import re

def cat_converter(text):
    """í…ìŠ¤íŠ¸ë¥¼ ëƒ¥ì²´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜"""
    if not text or not isinstance(text, str):
        return text
    
    result = text
    
       
    # ì˜ì–´ ë¬¸ì¥ ì²´í¬ (ì•ŒíŒŒë²³, ê³µë°±, ìˆ«ì, ê¸°ë³¸ ë¬¸ì¥ë¶€í˜¸ë§Œ í¬í•¨)
    if re.match(r'^[a-zA-Z\s\d.,!?;:\'"-]+$', result.strip()):
        # ë¬¸ì¥ ëì— ë¬¸ì¥ë¶€í˜¸ê°€ ìˆëŠ” ê²½ìš° ì•ì— meow ì¶”ê°€
        if re.search(r'[.!?]$', result.strip()):
            result = re.sub(r'([.!?])$', r' meow\1', result.strip())
        else:
            # ë¬¸ì¥ë¶€í˜¸ê°€ ì—†ëŠ” ê²½ìš° ê·¸ëƒ¥ meow ì¶”ê°€
            result = result.strip() + ' meow'
        return result
    
    # 0. ì‘ì€ë”°ì˜´í‘œ ì•ˆì˜ ë‚´ìš© ë³´í˜¸
    quoted_parts = {}
    quote_pattern = r"'([^']*?)'"
    
    def replace_quoted(match):
        placeholder = f"TEMP_QUOTE_{len(quoted_parts)}"
        quoted_parts[placeholder] = match.group(0)
        return placeholder
    
    result = re.sub(quote_pattern, replace_quoted, result)
    
    # 1. "ì•„ì•„" ë³´í˜¸ (ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸, ì˜ì„±ì–´)
    result = re.sub(r'ì•„ì•„', 'TEMP_AA', result)
    
    # 2. "ì•ˆë…•" â†’ "ì•ˆëƒ¥" ë³€í™˜
    result = re.sub(r'ì•ˆë…•', 'ì•ˆëƒ¥', result)
    result = re.sub(r'(í•´ë‚˜|í˜œë‚˜|í—¤ë‚˜|ë‹¤í˜œì‹ |ê³¤ë‡½\.|ê³¤ë‡½)',r'\1ğŸ¦–', result)

    # 3. "í•˜ì´" â†’ "ëƒ¥í•˜" ë³€í™˜ (ìƒˆë¡œ ì¶”ê°€)
    result = re.sub(r'í•˜ì´', 'ëƒ¥í•˜', result)

    # 4. ìƒˆë¡œìš´ ë³€í™˜ ê·œì¹™ë“¤ ì¶”ê°€
    # '-ë‚˜ìš”' â†’ 'ëƒ¥' ë³€í™˜
    result = re.sub(r'([ê°€-í£]+)ë‚˜ìš”(?=[!?\s.,]|$)', r'\1ëƒ¥', result)
    
    # '-ê°€ìš”' â†’ 'ê°€ëƒ¥' ë³€í™˜  
    result = re.sub(r'([ê°€-í£]+)ê°€ìš”(?=[!?\s.,]|$)', r'\1ê°€ëƒ¥', result)

    # 'í—' â†’ 'ë¨€ì•„' ë³€í™˜
    result = re.sub(r'(?<![ê°€-í£])í—(?![ê°€-í£])', 'ë¨€ì•„', result)
    
    # 'í•˜,' ë˜ëŠ” 'í•˜.' â†’ 'ëƒì•„,' ë˜ëŠ” 'ëƒì•„.' ë³€í™˜ (ì‰¼í‘œ/ë§ˆì¹¨í‘œê°€ ë¶™ì€ ê²½ìš°ë§Œ)
    result = re.sub(r'(?<![ê°€-í£])í•˜([,.])', r'ëƒì•„\1', result)
    
    # '-ì§€ì£ ' â†’ '-ì§€ëƒì˜¹' ë³€í™˜
    result = re.sub(r'([ê°€-í£]+)ì§€ì£ (?=[!?\s.,]|$)', r'\1ì§€ëƒì˜¹', result)
    
    # '-ìë‚˜' â†’ 'ìëƒì•„' ë³€í™˜
    result = re.sub(r'([ê°€-í£]+)ìë‚˜(?=[!?\s.,]|$)', r'\1ìëƒì•„', result)
    
    # '-ì„' â†’ '-ì´ë‹¤ëƒ¥' ë³€í™˜
    result = re.sub(r'([ê°€-í£]+)ì„(?=[!?\s.,]|$)', r'\1ì´ë‹¤ëƒ¥', result)
    
    # '-ì–ì•„' â†’ '-ì–ëƒì˜¹' ë³€í™˜
    result = re.sub(r'([ê°€-í£]+)ì–ì•„(?=[!?\s.,~]|$)', r'\1ì–ëƒì˜¹', result)
    
    # ê³¼ê±°í˜• ì–´ë¯¸ ë³€í™˜ë“¤
    # '-ê²ë‹ˆë‹¤' â†’ '-ê±°ë‹¤ëƒ¥' ë³€í™˜ (ê¸´ íŒ¨í„´ ë¨¼ì €)
    result = re.sub(r'([ê°€-í£]+)ê²ë‹ˆë‹¤(?=[!?\s.,]|$)', r'\1ê±°ë‹¤ëƒ¥', result)
    
    # '-êµ°' â†’ '-êµ¬ëƒì•„' ë³€í™˜
    result = re.sub(r'([ê°€-í£]+)êµ°(?=[!?\s.,]|$)', r'\1êµ¬ëƒì•„', result)
    
    # íŠ¹ë³„ í˜•ìš©ì‚¬ ë³€í™˜
    # 'ê·€ì—½ë‹¤' â†’ 'ê·€ì—½ë‹¤ëƒí•˜' ë³€í™˜
    result = re.sub(r'ê·€ì—½ë‹¤(?=[!?\s.,]|$)', 'ê·€ì—½ë‹¤ëƒí•˜', result)

    # ê³ ì–‘ì´
    result = re.sub(r'(ê³ ì–‘ì´|ëƒ¥ëƒ¥ì´|ëƒ¥ì´|ê³ ëƒ¥ì´)', 'ëƒ¥ì´ğŸ±', result)  # "ê³ ì–‘ì´" â†’ "ëƒ¥ì´ğŸ±"
    result = re.sub(r'í•´ëƒ¥ì´', 'í•´ëƒ¥ì´ğŸˆ', result) 


    # 5. ëŒ€ë‹µ ë³€í™˜: "ì‘" â†’ "ëƒ¥", "ë„¤" â†’ "ëƒ¥", "ì˜ˆ" â†’ "ë…œ" (ì œí•œì )
    result = re.sub(r'^ì‘(?=[!?\s.,]|$)', 'ëƒ¥', result)
    result = re.sub(r'(\s)ì‘(?=[!?\s.,]|$)', r'\1ëƒ¥', result)
    # "ë„¤"ëŠ” ëª…í™•í•œ ëŒ€ë‹µì¼ ë•Œë§Œ ë³€í™˜ (ë¬¸ì¥ë¶€í˜¸ì™€ í•¨ê»˜)
    result = re.sub(r'^ë„¤([!?.,])', r'ëƒ¥\1', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'^ë„¤(?=\s*$)', 'ëƒ¥', result)  # ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    result = re.sub(r'(\s)ë„¤([!?.,])', r'\1ëƒ¥\2', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'(\s)ë„¤(?=\s*$)', r'\1ëƒ¥', result)  # ì¤‘ê°„ì— ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    # "ì˜ˆ"ëŠ” ëª…í™•í•œ ëŒ€ë‹µì¼ ë•Œë§Œ ë³€í™˜ (ë¬¸ì¥ë¶€í˜¸ì™€ í•¨ê»˜)
    result = re.sub(r'^ì˜ˆ([!?.,])', r'ë…œ\1', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'^ì˜ˆ(?=\s*$)', 'ë…œ', result)  # ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    result = re.sub(r'(\s)ì˜ˆ([!?.,])', r'\1ë…œ\2', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'(\s)ì˜ˆ(?=\s*$)', r'\1ë…œ', result)  # ì¤‘ê°„ì— ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    
    # 6. ê°íƒ„ì‚¬ ë³€í™˜: ë¬¸ì¥ ë§¨ ì•ì˜ ê°íƒ„ì‚¬ ë³€í™˜ (ë¬¸ì¥ ë ì²˜ë¦¬ ì „ì— ì‹¤í–‰)
    result = re.sub(r'^ì™€!', 'ëƒì•„!', result)
    result = re.sub(r'^ì˜¤!', 'ëƒì•„!', result)
    result = re.sub(r'^ì•„!', 'ëƒì•„!', result)
    
    # ë¬¸ë‘ ë‹¨ë… ê°íƒ„ì‚¬ë„ ë³€í™˜ (ë¬¸ì¥ë¶€í˜¸ ì—†ì´) - ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°ë§Œ
    result = re.sub(r'^ì™€(?=\s)', 'ëƒì•„', result)  # ê³µë°± ì•ì˜ "ì™€"
    result = re.sub(r'^ì˜¤(?=\s)', 'ëƒì•„', result)  # ê³µë°± ì•ì˜ "ì˜¤"  
    result = re.sub(r'^ì•„(?=\s)', 'ëƒì•„', result)  # ê³µë°± ì•ì˜ "ì•„"
    result = re.sub(r'^(ì˜¤|ì•„|ì™€)$', 'ëƒì•„', result)
    
    # 7. ê°íƒ„ì‚¬ ë³€í™˜ (ì•—, ì•™, ìœ¼ì•…, ì•„ì•…) - ìœ„ì¹˜ì— ê´€ê³„ì—†ì´ ëª¨ë‘ ë³€í™˜
    result = re.sub(r'(?<![ê°€-í£])ì•™(?![ê°€-í£])', 'ëƒì•™', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ì•—(?![ê°€-í£])', 'ëƒì•—', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ìœ¼ì•…(?![ê°€-í£])', 'ëƒì•…', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ì•„ì•…(?![ê°€-í£])', 'ëƒì•…', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    
    # 8. ììŒ ì¡°í•© ë³€í™˜ (ê¸´ íŒ¨í„´ë¶€í„° ë¨¼ì € ì²˜ë¦¬)
    result = re.sub(r'ã…ã…‡ã…Œ', 'ëƒ¥ì´íŒ…', result)  # ã…ã…‡ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬
    result = re.sub(r'ã…ã…‡', 'ëƒ¥í•˜', result)
    result = re.sub(r'ã…‡ã…', 'ì–´ë¨¸ëƒ¥', result)
    result = re.sub(r'ã…ã…‡', 'ëª¨ëƒ¥', result)
    result = re.sub(r'ã„±ã…Š', 'ê´œì°®ëƒ¥', result)  # ã„±ã…Š â†’ ê´œì°®ëƒ¥
    # ã„±ã…‡ã…‡ë¥¼ ì„ì‹œë¡œ ë³´í˜¸
    result = re.sub(r'ã„±ã…‡ã…‡', 'TEMP_GYY', result)
    # ã…‡ã…‡ ë³€í™˜
    result = re.sub(r'ã…‡ã…‡', 'ì›…ëƒ¥', result)
    # ã„±ã…‡ã…‡ ë³µì›
    result = re.sub(r'TEMP_GYY', 'ã„±ã…‡ã…‡', result)
    
    result = re.sub(r'ã…‡ã„¸', 'ì–´ë– ëƒ¥', result)
    result = re.sub(r'(?<![ê°€-í£])ì•„í•˜(?![ê°€-í£])', 'ëƒí•˜', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ë…ë¦½ëœ "ì•„í•˜"ë§Œ
    
        #ë¯¸ì•¼ì˜¹ ì´ìŠ¤í„°ì—ê·¸
    
    result = re.sub(r'ë¯¸ì•¼ì˜¹ì¦ˆ', 'âœ¨ë¯¸ì•¼ì˜¹ì¦ˆâœ¨', result)
    result = re.sub(r'ë¯¸ì•¼ì˜¹', 'âœ¨ë¯¸ì•¼ì˜¹âœ¨', result)
    result = re.sub('í•´ë³´', 'í•´ë³´(ë°”ë³´)ğŸˆ', result)
    result = re.sub('ì†Œí”¼', 'ì†Œí”¼ğŸ€', result)


    # ìƒˆë¡œìš´ ììŒ/ëª¨ìŒ ë³€í™˜ ê·œì¹™ë“¤
    result = re.sub(r'ã…‹ã…‹+', r'\g<0>ëƒ¥í•˜í•˜', result)  # ã…‹ã…‹ â†’ ã…‹ã…‹ëƒ¥í•˜í•˜ (ë’¤ì— ì¶”ê°€)
    result = re.sub(r'ã…ã…+', r'\g<0>ë¨€í•˜í•˜', result)  # ã…ã… â†’ ã…ã…ë¨€í•˜í•˜
    result = re.sub(r'ã…œ+', 'ëƒì•„..', result)  # ã…œ â†’ ëƒì•„..

    # 9. íŠ¹ë³„ ë‹¨ì–´/ì–´ì ˆ ì²˜ë¦¬
    # "ê°œì›ƒ" â†’ "ëƒ¥ì›ƒ" (ê°œì›ƒê²¨, ê°œì›ƒê¸°ë‹¤, ê°œì›ƒê¹€ ë“±)
    result = re.sub(r'ê°œì›ƒ', 'ëƒ¥ì›ƒ', result)

        # íŠ¹ì • ì´ë¦„ ë³€í™˜
    result = re.sub(r'(?<![ê°€-í£])ì¡°ì´(?![ê°€-í£])', 'ì¡°ì´ëƒ¥ì´', result)
    result = re.sub(r'(?<![ê°€-í£])ë‘ì‹ì´(?![ê°€-í£])', 'ë‘ì‹ëƒ¥ì´', result)
    result = re.sub(r'(?<![ê°€-í£])ì„ì ˆë¯¸(?![ê°€-í£])', 'ì„ì ˆë©ì´', result)
    result = re.sub(r'(?<![ê°€-í£])í…ì‹œ(?![ê°€-í£])', 'í…ì‹œë©ì´', result)
    
    # ê³µë°± ë’¤ ê°•ì¡° í‘œí˜„: "ê°œì´ì˜", "ê°œê·€ì—½", "ê°œê·€ì—¬" â†’ "ëƒ¥ì´ì˜", "ëƒ¥ê·€ì—½", "ëƒ¥ê·€ì—¬" (ê°•ì¡° ìš©ë²•ë§Œ)
    result = re.sub(r'(\s)ê°œ(ì´ì˜|ê·€ì—½|ê·€ì—¬)', r'\1ëƒ¥\2', result)  # ê³µë°± ë’¤ì—ë§Œ
    
    # "ì¡´" ê°•ì¡° í‘œí˜„ ë³€í™˜ (ê³µë°± ë’¤ì—ë§Œ)
    result = re.sub(r'(\s)ì¡´(ì¼|ë§›|ë§›íƒ±|ì˜ˆ|ê·€|ì¢‹)', r'\1ëƒ¥\2', result)  # ê³µë°± ë’¤ì—ë§Œ
    
    # ë’¤ì— í•œê¸€ì´ ì˜¤ì§€ ì•ŠëŠ” ê²½ìš°ì—ë§Œ ëƒ¥ ë¶™ì´ê¸°
    result = re.sub(r'(ë§ì•„|ë§ˆì|ë§ˆì¢Œ|ë§ˆìŸˆ)(?![ê°€-í£])', r'\1ëƒ¥', result)

    # ë‹¤ì˜¹ ëƒì˜¹ 
    result = re.sub(r'([ê°€-í£])(ë‹¤|ë‚˜|ëƒ)\b', r'\1\2ì˜¹', result)
    result = re.sub(r'([ê°€-í£])ìš”\b', r'\1ì•¼ì˜¹', result)
    # 10. ë¬¸ì¥ ëì— "ëƒ¥" ì¶”ê°€ (í•œêµ­ì–´ê°€ í¬í•¨ëœ ê²½ìš°ë§Œ)
    if re.search(r'[ê°€-í£]', result):
        # ë¬¸ì¥ ë ì²˜ë¦¬ - ë¬¸ì¥ë¶€í˜¸ë¡œ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<!ëƒ¥)(\s*[.!?~\\,;]+)', r'\1ëƒ¥\2', result)  # ë¬¸ì¥ë¶€í˜¸ë¡œ ë (ê³µë°± í¬í•¨)
        
        # ì´ëª¨í‹°ì½˜ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<!ëƒ¥)(\s*\^\^\s*$)', r'\1ëƒ¥\2', result)  # ^^ ì´ëª¨í‹°ì½˜
        result = re.sub(r'([ê°€-í£])(?<!ëƒ¥)(\s*:\)\s*$)', r'\1ëƒ¥\2', result)  # :) ì´ëª¨í‹°ì½˜
        result = re.sub(r'([ê°€-í£])(?<!ëƒ¥)(\s*[\U0001F600-\U0001F64F\U0001F300-\U0001F5FF\U0001F680-\U0001F6FF\U0001F1E0-\U0001F1FF\u2600-\u26FF\u2700-\u27BF]+\s*$)', r'\1ëƒ¥\2', result)  # ìœ ë‹ˆì½”ë“œ ì´ëª¨í‹°ì½˜
        
        # ììŒ/ëª¨ìŒ(ã…‹ã…‹, ã…ã…, ã…‡ã…‹ ë“±) ì•ì˜ í•œê¸€ì— "ëƒ¥" ì¶”ê°€
        result = re.sub(r'([ê°€-í£])(?<!ëƒ¥)(\s*[ã„±-ã…ã…-ã…£ã…‹ã…ã…‡ã…‹]+)', r'\1ëƒ¥\2', result)  # ììŒ/ëª¨ìŒ ì•
        
        # ì¤„ë°”ê¿ˆ ì²˜ë¦¬
        result = re.sub(r'([ê°€-í£])(?<!ëƒ¥)(\s*\r?\n)', r'\1ëƒ¥\2', result)  # ì¤„ë°”ê¿ˆìœ¼ë¡œ ë
        
        # ë¬¸ì¥ë¶€í˜¸ ì—†ì´ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<!ëƒ¥)(\s*$)', r'\1ëƒ¥\2', result)  # ê·¸ëƒ¥ ëë‚˜ëŠ” ê²½ìš°
    
    # 11. ê°íƒ„ì‚¬ ë³€í™˜: "ì™€!" â†’ "ëƒì•„!", "ì˜¤!" â†’ "ëƒì•„!" (ë¬¸ì¥ ë ì²˜ë¦¬ í›„ì— ì‹¤í–‰)
    result = re.sub(r'^ì™€!', 'ëƒì•„!', result)
    result = re.sub(r'(\s)ì™€!', r'\1ëƒì•„!', result)
    result = re.sub(r'^ì˜¤!', 'ëƒì•„!', result)
    result = re.sub(r'(\s)ì˜¤!', r'\1ëƒì•„!', result)
    
    # 12. ë¶ˆí•„ìš”í•œ "ëƒ¥" ì œê±° (íŠ¹ë³„ ë³€í™˜ í›„ ë¶™ì€ ëƒ¥ ì •ë¦¬)
    # ë‹¨ì¼ íŒ¨í„´ ë’¤ì˜ ëƒ¥ ì œê±°
    result = re.sub(r'(í•´ë³´(ë°”ë³´)|ì†Œí”¼|ê³¤ë‡½|ëƒ¥í•˜í•˜|ëƒì•™|ëƒì•—|ëƒì•…|ì–´ë– ëƒ¥|ëƒí•˜|ì–´ë¨¸ëƒ¥|ëª¨ëƒ¥|ê´œì°®ëƒ¥|ëƒ¥ì´íŒ…|ë…œ|ëƒì•„|ëƒ¥ì¼|ëƒ¥ë§›|ëƒ¥ë§›íƒ±|ëƒ¥ì˜ˆ|ëƒ¥ê·€|ëƒ¥ì¢‹|ì˜¹|ë¨€í•˜í•˜|ëƒí•˜í•˜|ëƒ¥ì´|êµ¬ëƒì•„|ë¨€ì•„|ëƒ¥ì›ƒê²¨|ëƒ¥ì›ƒê¸°ë‹¤|ëƒ¥ì›ƒê¹€|ëƒ¥ì›ƒê³€|ë¯¸ì•¼ì˜¹|ë¯¸ì•¼ì˜¹ì¦ˆ)ëƒ¥', r'\1', result)
    
    # ì—°ì† íŒ¨í„´ì˜ ë§ˆì§€ë§‰ì—ë§Œ ëƒ¥ ë‚¨ê¸°ê¸° (ì˜ˆ: ëƒ¥í•˜ëƒ¥í•˜ëƒ¥ â†’ ëƒ¥í•˜ëƒ¥í•˜)
    result = re.sub(r'(ëƒ¥í•˜)+ëƒ¥(?![ëƒ¥í•˜])', lambda m: m.group(0)[:-1], result)  # ëƒ¥í•˜ ì—°ì† í›„ ë§ˆì§€ë§‰ ëƒ¥ë§Œ ì œê±°
    result = re.sub(r'(ì›…ëƒ¥)+ëƒ¥(?![ì›…ëƒ¥])', lambda m: m.group(0)[:-1], result)  # ì›…ëƒ¥ ì—°ì†ë„ ê°™ì€ ë°©ì‹
    
    # 13. "ì•„ì•„" ë³µì›
    result = re.sub(r'TEMP_AA', 'ì•„ì•„', result)
    
    # 14. ì‘ì€ë”°ì˜´í‘œ ë‚´ìš© ë³µì› (ë§¨ ë§ˆì§€ë§‰ì—)
    for placeholder, original in quoted_parts.items():
        result = result.replace(placeholder, original)
    
    return result

