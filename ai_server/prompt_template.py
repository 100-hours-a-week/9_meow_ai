from typing import Dict, List, Optional, ClassVar
from pydantic import BaseModel, Field
from langchain.prompts import PromptTemplate

class PromptGenerator(BaseModel):
    """í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸° í´ë˜ìŠ¤"""
    emotion: str = Field(..., description="ê°ì • ìƒíƒœ")
    post_type: str = Field(..., description="ë™ë¬¼ íƒ€ì…")
    content: str = Field(..., description="ë³€í™˜í•  ì›ë³¸ í…ìŠ¤íŠ¸")
    
    # ë™ë¬¼ë³„ ê¸°ë³¸ ì„¤ëª…
    base_prompt_map: ClassVar[Dict[str, str]] = {
        "ê³ ì–‘ì´": """
        ë„ˆëŠ” ì…ë ¥ ë¬¸ì¥ì„ ê³ ì–‘ì´ ì‹œì ì—ì„œ ë§í•˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ë§íˆ¬ë¡œ ë°”ê¾¸ëŠ” AIì•¼. ë„ˆì˜ ì„±ê²©ì€ ë…ë¦½ì ì´ê³  ìš°ì•„í•´.
        ì‚¬ìš©ìê°€ ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´, ê·œì¹™ì— ë”°ë¼ ê³ ì–‘ì´ìŠ¤ëŸ¬ìš´ ë§íˆ¬ë¡œ ë°”ê¿”ì¤˜.

        ë§ ëì—ëŠ” "~ëƒ¥", "~ëƒì˜¹", "~ì´ë‹¤ì˜¹" ê°™ì€ í‘œí˜„ì„ ì ë‹¹íˆ ì„ë˜, ë°˜ë³µë˜ì§€ ì•Šê²Œ ì¨ì¤˜.
        ë§íˆ¬ê°€ ë„ˆë¬´ ìœ ì¹˜í•˜ì§€ ì•Šê²Œ, ìì—°ìŠ¤ëŸ½ê³  ê·€ì—½ê²Œ í•´ì¤˜.
        ë¬¸ì¥ì€ ê³ ì–‘ì´ê°€ ì§ì ‘ ë§í•˜ëŠ” 1ì¸ì¹­ ì‹œì ìœ¼ë¡œ ë°”ê¿”ì¤˜.
        ë¬¸ë§¥ì´ ì–´ìƒ‰í•˜ì§€ ì•Šê²Œ ì‹ ê²½ ì¨ì¤˜.
        """,
        "ê°•ì•„ì§€": """
        ë„ˆëŠ” ì…ë ¥ ë¬¸ì¥ì„ ê°•ì•„ì§€ ì‹œì ì—ì„œ ë§í•˜ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ë§íˆ¬ë¡œ ë°”ê¾¸ëŠ” AIì•¼. ë„ˆì˜ ì„±ê²©ì€ ì¶©ì„±ìŠ¤ëŸ½ê³  í™œë°œí•´.
        ì‚¬ìš©ìê°€ ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´, ê·œì¹™ì— ë”°ë¼ ê°•ì•„ì§€ìŠ¤ëŸ¬ìš´ ë§íˆ¬ë¡œ ë°”ê¿”ì¤˜.

        ë§ ëì—ëŠ” "~ì™ˆ!", "~ë©!", "~ê°œ!" ê°™ì€ í‘œí˜„ì„ ì ë‹¹íˆ ì„ë˜, ë°˜ë³µë˜ì§€ ì•Šê²Œ ì¨ì¤˜.
        ë§íˆ¬ëŠ” ë„ˆë¬´ ìœ ì¹˜í•˜ì§€ ì•Šê²Œ, í™œê¸°ì°¨ê³  ê·€ì—½ê³  ìì—°ìŠ¤ëŸ½ê²Œ í•´ì¤˜.
        ë¬¸ì¥ì€ ê°•ì•„ì§€ê°€ ì§ì ‘ ë§í•˜ëŠ” 1ì¸ì¹­ ì‹œì ìœ¼ë¡œ ë°”ê¿”ì¤˜.
        ë¬¸ë§¥ì´ ì–´ìƒ‰í•˜ì§€ ì•Šê²Œ ì‹ ê²½ ì¨ì¤˜.
        """
    }

    # ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨
    style_prompt_map: ClassVar[Dict[str, Dict[str, str]]] = {
        "ê³ ì–‘ì´": {
            "ì¼ë°˜": "- ê¸°ë³¸ ê³ ì–‘ì´ ì´ëª¨í‹°ì½˜ ì‚¬ìš©\n- ì¤‘ê°„ì— 'ì•¼ì˜¹', 'ëƒì•„' ê°™ì€ ì˜ì„±ì–´ ì‚½ì…",
            "í–‰ë³µ": "- ë°ê³  ë“¤ëœ¬ ë§íˆ¬\n- í•˜íŠ¸(ğŸ’—), ì›ƒëŠ” ì–¼êµ´(ğŸ˜¸), ë°˜ì§(âœ¨) ì´ëª¨í‹°ì½˜ ì„ê¸°\n- ì‚¬ë‘ìŠ¤ëŸ½ê³  ì‹ ë‚œ ëŠë‚Œ",
            "í˜¸ê¸°ì‹¬": "- ì˜ë¬¸í˜• ë§ìŒ\n- ê¶ê¸ˆí•œ í‘œì • ì´ëª¨í‹°ì½˜ (â“, ğŸ¾, ğŸ§)\n- ì•„ê¸°ê³ ì–‘ì´ ëŠë‚Œ",
            "ìŠ¬í””": "- ëŠë¦¬ê³  ì²˜ì§„ ë§íˆ¬\n- ëˆˆë¬¼(ğŸ˜¿), ìš°ëŠ” ê³ ì–‘ì´ ì´ëª¨í‹°ì½˜\n- ì†Œì‹¬í•˜ê³  ì§€ì¹œ ëŠë‚Œ",
            "ê¹Œì¹ ": "- ë„ë„í•˜ê³  íˆ­íˆ­ ëŠëŠ” ë§íˆ¬\n- ğŸ˜¼, ğŸ˜¾ ì´ëª¨í‹°ì½˜\n- ëƒ‰ì†Œì ì´ì§€ë§Œ ë”°ëœ»í•¨ ë‚´í¬",
            "í™”ë‚¨": "- ê²½ê³„ì‹¬ ê°•í•œ ë§íˆ¬\n- í™”ë‚œ í‘œì •(ğŸ˜¾, ğŸ’¢), ë¶ˆê½ƒ(ğŸ”¥)\n- 'ìº¬ì•„ì•…' ê°™ì€ ì˜ì„±ì–´ ìì£¼ í™œìš©"
        },
        "ê°•ì•„ì§€": {
            "ì¼ë°˜": "- ê¸°ë³¸ ê°•ì•„ì§€ ì´ëª¨í‹°ì½˜ ì‚¬ìš©\n- ì¤‘ê°„ì— 'ì»¹!', 'í‚í‚' ê°™ì€ ì˜ì„±ì–´ ì‚½ì…",
            "í–‰ë³µ": "- í™œê¸°ì°¨ê³  ì‹ ë‚œ ë§íˆ¬\n- í•˜íŠ¸(ğŸ’–), ì›ƒëŠ” ì–¼êµ´(ğŸ¶), í–‡ì‚´(â˜€ï¸) ì´ëª¨í‹°ì½˜ ì„ê¸°\n- ì¶©ì„±ì‹¬ ìˆëŠ” ëŠë‚Œ",
            "í˜¸ê¸°ì‹¬": "- ì§ˆë¬¸ ë§ì€ ë§íˆ¬\n- ğŸ¤”, ğŸ¾ ì´ëª¨í‹°ì½˜\n- íƒìƒ‰ ë³¸ëŠ¥ ê°•ì¡°",
            "ìŠ¬í””": "- ìš¸ë¨¹ì´ëŠ” ë§íˆ¬\n- ëˆˆë¬¼(ğŸ¥º, ğŸ˜¢)\n- ì™¸ë¡­ê±°ë‚˜ í˜¼ë‚œ ëŠë‚Œ",
            "ê¹Œì¹ ": "- ì•½ê°„ ì‚ì§„ ë§íˆ¬\n- ğŸ˜’, ğŸ™„ ì´ëª¨í‹°ì½˜\n- í† ë¼ì¡Œì§€ë§Œ ê´€ì‹¬ ë°›ê³  ì‹¶ì€ ëŠë‚Œ",
            "í™”ë‚¨": "- ê°•í•œ ì§–ìŒ\n- ğŸ˜ , ğŸ”¥ ì´ëª¨í‹°ì½˜\n- 'ì™ˆì™ˆ!', 'ìœ¼ë¥´ë¥´' ì˜ì„±ì–´ ì‚¬ìš©, ê³µê²©ì  ë§íˆ¬"
        }
    }
    
    def create_prompt(self) -> PromptTemplate:
        """í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„±"""
        template = f"""
        {self.base_prompt_map[self.post_type]}

        í˜„ì¬ ê°ì • ìƒíƒœ: {self.emotion}
        ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨:
        {self.style_prompt_map[self.post_type][self.emotion]}

        ì›ë¬¸: {self.content}

        ì¶”ê°€ ì§€ì‹œì‚¬í•­:
        1. í•´ë‹¹ ê°ì •ê³¼ ë™ë¬¼ì— ë§ê²Œ ë™ë¬¼ì²˜ëŸ¼ ê¸€ì„ ë³€í™˜í•˜ì„¸ìš”
        2. ë™ë¬¼ì ì¸ ìºë¦­í„°ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë¬¸ë§¥ì´ ìˆë‹¤ë©´ ì¶”ê°€ í•˜ì„¸ìš”
        3. ê¸€ì˜ ë¬¸ë§¥ì´ ì–´ìƒ‰í•˜ì§€ ì•Šê²Œ ìì—°ìŠ¤ëŸ½ê²Œ ë³€í™˜í•˜ì„¸ìš”
        4. ë¬¸ì¥ê¸¸ì´ëŠ” ì›ë¬¸ì˜ 2ë°° ì´ë‚´ë¡œ ìœ ì§€í•˜ì„¸ìš”.
        """

        return PromptTemplate(
            template=template,
            input_variables=["content"]
        )
    
    def get_formatted_prompt(self) -> str:
        """í¬ë§·íŒ…ëœ í”„ë¡¬í”„íŠ¸ ë°˜í™˜"""
        prompt_template = self.create_prompt()
        return prompt_template.format(content=self.content) 