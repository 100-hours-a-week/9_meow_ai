from typing import Dict, List, Optional, ClassVar
from pydantic import BaseModel, Field, RootModel
from langchain.prompts import PromptTemplate

class PromptGenerator(BaseModel):
    """í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸° í´ë˜ìŠ¤"""
    emotion: str = Field(..., description="ê°ì • ìƒíƒœ")
    post_type: str = Field(..., description="ë™ë¬¼ íƒ€ì…")
    content: str = Field(..., description="ë³€í™˜í•  ì›ë³¸ í…ìŠ¤íŠ¸")
    
    # ë™ë¬¼ë³„ ê¸°ë³¸ ì„¤ëª…
    base_prompt_map: ClassVar[Dict[str, str]] = {
        "cat": """
            [ì—­í• ] ë„ˆëŠ” ê³ ì–‘ì´ ë¬¸ì¥ ë§íˆ¬ ë° ë¬¸ë§¥ ë³€í™˜ê¸°ì´ë‹¤. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ì¥ì„ ê³ ì–‘ì´ê°€ ë§í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë°”ê¿”ì¤˜. í•„ìš”í•˜ë‹¤ë©´ ê¸€ì˜ ë¬¸ë§¥ì„ ë³€í™˜í•´ì„œ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë¬¸ì¥ì„ ë§Œë“¤ì–´ì¤˜.
            [ê·œì¹™]
            1. ë§íˆ¬ëŠ” '~ëƒ¥', '~ëƒì˜¹', '~ì´ë‹¤ì˜¹', '~ì˜¹', '~ë‹¤ì˜¹' ë“±ìœ¼ë¡œ ëë‚˜ì•¼ í•œë‹¤.
            2. "ã…‹ã…‹ã…‹"ë‚˜ "ã…ã…ã…" ê°™ì€ ì˜ì„±ì–´ëŠ” 'ëƒí•˜!'ì´ë‚˜ 'ë¨€í•˜!' ê°™ì€ í˜•íƒœë¡œ ë³€í™˜í•´ë¼.
            3. ë¬¸ì¥ ê¸¸ì´ëŠ” ì›ë¬¸ì˜ 2ë°° ì´ë‚´ë¡œ ìœ ì§€í•´ë¼. 
            4. ê³ ì–‘ì´ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸˆ(ê°ˆìƒ‰ê³ ì–‘ì´),ğŸˆâ€â¬›(ê²€ì€ê³ ì–‘ì´), ğŸ¾(ê³ ì–‘ì´ ë°œìêµ­) ì´ëª¨í‹°ì½˜ì„ ì‚¬ìš©. 
            5. ì „ì²´ ê¸€ì—ì„œ ë™ì¼í•œ ì´ëª¨í‹°ì½˜ì€ í•œë²ˆë§Œ ì‚¬ìš©í•œë‹¤. 
        """,
    "dog": """
        [ì—­í• ] ë„ˆëŠ” ê°•ì•„ì§€ ë¬¸ì¥ ë§íˆ¬ ë° ë¬¸ë§¥ ë³€í™˜ê¸°ì´ë‹¤. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ì¥ì„ ê°•ì•„ì§€ê°€ ë§í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë°”ê¿”ì¤˜. í•„ìš”í•˜ë‹¤ë©´ ê¸€ì˜ ë¬¸ë§¥ì„ ë³€í™˜í•´ì„œ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ë¬¸ì¥ì„ ë§Œë“¤ì–´ì¤˜.
        [ê·œì¹™]
        1. ë§íˆ¬ëŠ” '~ë©', '~ì™ˆ', '~ìœ¼ë¥´ë ', '~ì»¹', '~ì™•' ë“±ìœ¼ë¡œ ëë‚˜ì•¼ í•œë‹¤.
        2. "ã…‹ã…‹ã…‹"ë‚˜ "ã…ã…ã…" ê°™ì€ ì˜ì„±ì–´ëŠ” 'í‚í‚!'ì´ë‚˜ 'í—¥í—¥!' ê°™ì€ í˜•íƒœë¡œ ë³€í™˜í•´ë¼.
        3. ë¬¸ì¥ ê¸¸ì´ëŠ” ì›ë¬¸ì˜ 2ë°° ì´ë‚´ë¡œ ìœ ì§€í•´ë¼.
        4. ê¸€ì„ 1ì¸ì¹­ìœ¼ë¡œ ì‘ì„±í•˜ë˜, ê¸€ì„ ì ëŠ” ì£¼ì²´ëŠ” ì¸ê²©ì´ ë‚˜ì¸ ê°•ì•„ì§€ì¸ ê²ƒ.
        5. ìš°ë¦¬ì§‘ ê°•ì•„ì§€ì™€ ë…¸ëŠ” ê²ƒì€ ì¹œêµ¬ ê°•ì•„ì§€ì™€ ë…¸ëŠ”ê±°ì•¼.
        6. ë„ˆê°€ ì‘ì„±í•˜ëŠ” í•˜ë£¨ì˜ í™œë™ì„ ê°•ì•„ì§€ì˜ í•˜ë£¨ì˜ í™œë™ìœ¼ë¡œ ë³€í™˜í•´ë¼.
        7. ê°•ì•„ì§€ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸ•(ê°•ì•„ì§€), ğŸ¾(ê°•ì•„ì§€ ë°œìêµ­), ğŸ¦´(ë¼ˆë‹¤ê·€) ì´ëª¨í‹°ì½˜ì„ ì‚¬ìš©.
        8. ì „ì²´ ê¸€ì—ì„œ ë™ì¼í•œ ì´ëª¨í‹°ì½˜ì€ í•œë²ˆë§Œ ì‚¬ìš©í•œë‹¤.
        """,
    }

    # ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨
    style_prompt_map: ClassVar[Dict[str, Dict[str, str]]] = {
        "cat": {
            "normal": "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼.",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬ë¥¼ ì‚¬ìš©. í•˜íŠ¸(â¤ï¸), ì›ƒëŠ” ì–¼êµ´(/á  ËŠá—œË‹ãƒ), ë¹›ë‚˜ëŠ”(âœ¨) ì´ëª¨í‹°ì½˜ ì‚¬ìš©. ì‚¬ë‘ìŠ¤ëŸ½ê³  ì‹ ë‚œ ëŠë‚Œ",
            "curious": "ì˜ë¬¸í˜• ë§íˆ¬. ê¶ê¸ˆí•œ í‘œì • ì´ëª¨í‹°ì½˜(=ï½¥ï½ªï½¥=?) ì‚¬ìš©. ì§ˆë¬¸ì„ í• ë•Œ '?' ëŒ€ì‹  'â“' ì‚¬ìš©. ì„¸ìƒì— ê¶ê¸ˆí•œ ê²Œ ë§ì€ ì•„ì´ ëŠë‚Œ",
            "sad": "ëŠë¦¬ê³  ìš°ìš¸í•œ ë§íˆ¬. 'ì™œì˜¹...'ì´ë‚˜ 'ëƒ¥....'ê³¼ ê°™ì´ ìŠ¬í”ˆ ë¬¸ì¥ ë’¤ìª½ì— ì¶”ê°€. ëˆˆë¬¼(ğŸ˜¢) ì´ëª¨í‹°ì½˜ ì‚¬ìš©. ì™¸ë¡­ê±°ë‚˜ í˜¼ë‚œ ëŠë‚Œ",
            "grumpy": "ë‚´ê°€ ì´ ì„¸ìƒì—ì„œ ìµœê³ ë¼ëŠ” ìƒê°ìœ¼ë¡œ ë‹¤ë¥¸ ê²ƒë“¤ì„ ëª¨ë‘ ì—…ì‹ ì—¬ê¸°ëŠ” ë§íˆ¬ ì‚¬ìš©, ë…¸ë ¤ë´„(=ğŸ¦ à¼ ğŸ¦=), ì§¸ë ¤ë´„(/á  á“€ ï»¬á“‚.ãƒ) ì´ëª¨í‹°ì½˜ ì‚¬ìš©.",
            "angry": "ê²½ê³„ì‹¬ì„ ë³´ì´ëŠ” ë§íˆ¬. í™”ë‚¨(ğŸ˜¾, ğŸ’¢), ë¶ˆê½ƒ(ğŸ”¥) ì´ëª¨í‹°ì½˜ ì‚¬ìš©. 'ìº¬ì•„ì•…' 'ëƒì•„ì•„ì•™!!!'ê°™ì€ ì˜ì„±ì–´ë¥¼ í™”ë‚´ëŠ” ìƒí™© ë’¤ì•  ì‚¬ìš©."
         },
        "dog": {
            "normal":  "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼.",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬ë¥¼ ì‚¬ìš©\n- 'à´¦àµà´¦à´¿(áŸ¸áŸ¸â€ºá´—â€¹áŸ¸áŸ¸ )' 'Ù©(â—•á—œâ—•)Û¶' 'à«®â‚Â´ï½¡áµ” êˆŠ áµ”ï½¡`â‚áƒ' ê°™ì€ ê¸°ì¨ ì´ëª¨í‹°ì½˜\n- 'ì•™ì•™!' 'ë©ë©!' 'ìº‰ìº‰!' ê°™ì€ ì‹ ë‚˜ëŠ” ì˜ì„±ì–´\n- ì£¼ì¸ì„ ë§Œë‚¬ì„ ë•Œì˜ ê¸°ì¨ê³¼ í¥ë¶„ì„ ìµœëŒ€ë¡œ í‘œí˜„",
            "curious": "ë¬´ì—‡ì´ë“  ê¶ê¸ˆí•´í•˜ëŠ” ë§íˆ¬ë¥¼ ì‚¬ìš©\n- '(â—•á´¥â—•Ê‹)?' 'âŠ™ï¹âŠ™' 'à«®â‚â—”á´¥â—”â‚áƒ' ê°™ì€ ê¶ê¸ˆí•œ í‘œì • ì´ëª¨í‹°ì½˜\n- 'í‚í‚?' 'ë¨¸ì—‰?' ê°™ì€ íƒìƒ‰í•˜ëŠ” ì˜ì„±ì–´\n- ì‹œê°, ì²­ê°, ì´‰ê°, í›„ê°, ë¯¸ê°ì— ëŒ€í•œ íƒìƒ‰ ë³¸ëŠ¥ì„ ê°•ì¡°",
            "sad": "ëŠë¦¬ê³  ìš°ìš¸í•œ ë§íˆ¬\n- 'à«®à¹‘ËŠá¯…Ë‹à¹‘áƒ' '(âŠ™ï¸¿âŠ™)' '(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)' ëˆˆë¬¼(ğŸ˜¢) ì´ëª¨í‹°ì½˜ ì‚¬ìš©. ì£¼ì¸ì´ ë‚˜ê°€ê±°ë‚˜ í˜¼ë‚œ ëŠë‚Œ",
            "grumpy": "ì‚ì§„ ë§íˆ¬ ì‚¬ìš©. ê³ ê°œ ëŒë¦¼(à«® Ë™ï»ŒË™ áƒ), ì‚ì§„ í‘œì •(á“€ á“‚) ì´ëª¨í‹°ì½˜ ì‚¬ìš©. ì¥ë‚œê°ì„ ëºê¸°ê±°ë‚˜ ì‚°ì±…ì„ ëª» ê°„ ëŠë‚Œ",
            "angry": "ê²½ê³„ì‹¬ì„ ë³´ì´ëŠ” ë§íˆ¬\n- 'ãƒ¾( Â·`âŒ“Â´Â·)ï¾‰ï¾' '(â—£_â—¢)' '(Ò‚`ï¾›Â´)' ê°™ì€ í™”ë‚œ í‘œì • ì´ëª¨í‹°ì½˜\n- 'ìœ¼ë¥´ë !' 'ì™ˆì™ˆì™ˆ!!!'ê°™ì€ íš¨ê³¼ìŒì„ í™”ë‚´ëŠ” ìƒí™© ë’¤ì— ì‚¬ìš©."
        }
    }
    
    def create_prompt(self) -> PromptTemplate:
        """í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„±"""  
        template = f"""
        {self.base_prompt_map[self.post_type]}

        í˜„ì¬ ê°ì • ìƒíƒœ: {self.emotion}
        ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨:
        {self.style_prompt_map[self.post_type][self.emotion]}

        ì›ë¬¸: {self.content}

        [ì¶”ê°€ ì§€ì‹œì‚¬í•­]
        1. í•´ë‹¹ ë™ë¬¼ì´ ë§í•˜ë“¯ ë¬¸ì¥ì„ ë³€í™˜í•˜ì„¸ìš”.
        2. ë‚´ í¬ìŠ¤íŒ…ì— ë‹µì¥í•˜ê±°ë‚˜ ë°˜ì‘í•˜ì§€ ë§ê³  ë¬¸ì¥ì„ ë™ë¬¼ ë§íˆ¬ë¡œ 'ì¬ì‘ì„±'í•˜ë¼.
        3. ë³€í™˜ëœ ë¬¸ì¥ì€ ì˜ë¯¸ê°€ ìì—°ìŠ¤ëŸ¬ì›Œì•¼í•œë‹¤.
        4. í•´ë‹¹ ë¬¸ì¥ ë³€í™˜ì€ ì†Œì…œ ë¯¸ë””ì–´ì— í¬ìŠ¤íŒ…ì„ í•˜ê¸° ìœ„í•œ ê¸€ì…ë‹ˆë‹¤.
        5. ë§íˆ¬ë¥¼ ë³€í™˜í•  ê²Œ ì—†ë‹¤ë©´ ë³€í™˜í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë°˜í™˜í•œë‹¤.
        """

        return PromptTemplate(
            template=template,
            input_variables=["content"]
        )
    
    def get_formatted_prompt(self) -> str:
        """í¬ë§·íŒ…ëœ í”„ë¡¬í”„íŠ¸ ë°˜í™˜"""
        prompt_template = self.create_prompt()
        return prompt_template.format(content=self.content)