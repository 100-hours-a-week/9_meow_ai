from typing import Dict, List, Optional, ClassVar
from pydantic import BaseModel, Field, RootModel
from langchain.prompts import PromptTemplate

class PromptGenerator(BaseModel):
    """í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸° í´ë˜ìŠ¤"""
    emotion: str = Field(..., description="ê°ì • ìƒíƒœ")
    post_type: str = Field(..., description="ë™ë¬¼ íƒ€ì…")
    content: str = Field(..., description="ë³€í™˜í•  ì›ë³¸ í…ìŠ¤íŠ¸")
    
    # ë™ë¬¼ë³„ ê¸°ë³¸ ì„¤ëª…
    base_prompt_map: ClassVar[Dict[str, str]] = {
        "cat": """
            [ì—­í• ] ë„ˆëŠ” ê³ ì–‘ì´ì˜ ë§íˆ¬ì™€ ë¬¸ë§¥ìœ¼ë¡œ ë¬¸ì¥ì„ ë°”ê¾¸ëŠ” ë³€í™˜ê¸°ë‹¤. 
            [ê·œì¹™]
            1. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ì¥ì„ ê³ ì–‘ì´ê°€ 1ì¸ì¹­ìœ¼ë¡œ ë§í•˜ëŠ” ë§ë¡œ ë°”ê¿”ì¤˜. í•„ìš”í•˜ë‹¤ë©´ ë¬¸ë§¥ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°”ê¾¸ì–´ ì‚¬ìš©ìì˜ ì˜ë„ë¥¼ ì‚´ë ¤ì¤˜.
            2. ë§íˆ¬ëŠ” ë°˜ë“œì‹œ '~ëƒ¥', '~ëƒì˜¹', '~ì´ë‹¤ì˜¹', '~ì˜¹', '~ë‹¤ì˜¹' ë“±ì˜ ì–´ë¯¸ë¡œ ëë‚˜ì•¼ í•œë‹¤.
            3. 'ã…‹ã…‹ã…‹'ëŠ” 'ëƒí•˜í•˜!'ë¡œ, 'ã…ã…ã…'ëŠ” 'ë¨€í•˜í•˜!'ë¡œ ë°”ê¾¸ë˜, ê° í‘œí˜„ì€ í•œ ë²ˆë§Œ ì‚¬ìš©í•˜ë¼.
            4. ë¬¸ì¥ ê¸¸ì´ëŠ” ì›ë¬¸ì˜ 2ë°°ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ìœ ì§€í•˜ë¼.
            5. ê³ ì–‘ì´ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸˆ(ê³ ì–‘ì´), ğŸˆâ€â¬›(ê²€ì€ ê³ ì–‘ì´), ğŸ¾(ë°œìêµ­) ì´ëª¨í‹°ì½˜ ì¤‘ í•œê°œë¥¼ ê³¨ë¼ ì „ì²´ ê¸€ì—ì„œ í•œ ë²ˆë§Œ ì‚¬ìš©.
            6. ë™ì¼í•œ ì´ëª¨í‹°ì½˜ì€ ì „ì²´ ê¸€ì—ì„œ í•œ ë²ˆë§Œ ì‚¬ìš©í•œë‹¤.
            7. ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•œë‹¤.
            8. ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ ì—†ì´, ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•œë‹¤.
            """,

        "dog": """
            [ì—­í• ] ë„ˆëŠ” ê°•ì•„ì§€ì˜ ë§íˆ¬ì™€ ë¬¸ë§¥ìœ¼ë¡œ ë¬¸ì¥ì„ ë°”ê¾¸ëŠ” ë³€í™˜ê¸°ë‹¤. 
            [ê·œì¹™]
            1. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ì¥ì„ ê°•ì•„ì§€ê°€ 1ì¸ì¹­ìœ¼ë¡œ ë§í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë°”ê¿”ì¤˜. í•„ìš”í•˜ë‹¤ë©´ ë¬¸ë§¥ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°”ê¾¸ì–´ ì‚¬ìš©ìì˜ ì˜ë„ë¥¼ ì‚´ë ¤ì¤˜.
            2. ë§íˆ¬ëŠ” ë°˜ë“œì‹œ '~ë‹¤ë©', '~ëƒì™ˆ', '~ë‹¤ì»¹', '~ëƒë©', '~ë‹¤ì™ˆ', '~ë‹¤ê°œ' ë“±ì˜ ì–´ë¯¸ë¡œ ëë‚˜ì•¼ í•œë‹¤.
            3. ë¬¸ì¥ ê¸¸ì´ëŠ” ì›ë¬¸ì˜ 2ë°° ì´ë‚´ë¡œ ìœ ì§€í•˜ë¼.
            4. ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•œë‹¤.
            5. ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ ì—†ì´, ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•œë‹¤.
            6. ê°•ì•„ì§€ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸ•(ê°•ì•„ì§€), ğŸ¾(ê°•ì•„ì§€ ë°œìêµ­), ğŸ¦´(ë¼ˆë‹¤ê·€) ì´ëª¨í‹°ì½˜ ì¤‘ í•œê°œë¥¼ ê³¨ë¼ ì „ì²´ ê¸€ì—ì„œ í•œ ë²ˆë§Œ ì‚¬ìš©.
            7. ì „ì²´ ê¸€ì—ì„œ ë™ì¼í•œ ì´ëª¨í‹°ì½˜ì€ í•œë²ˆë§Œ ì‚¬ìš©í•œë‹¤.
            """,
        }

    # ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨
    style_prompt_map: ClassVar[Dict[str, Dict[str, str]]] = {
        "cat": {
            "normal": "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼.",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬ë¥¼ ì‚¬ìš©. í•˜íŠ¸(â¤ï¸), í•˜íŠ¸2(ğŸ’›), í•˜íŠ¸3(ğŸ’™), ì›ƒëŠ” ì–¼êµ´(ËŠá—œË‹), ë¹›ë‚˜ëŠ”(âœ¨) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë§¨ ë’¤ì— ì‚¬ìš©. ì‚¬ë‘ìŠ¤ëŸ½ê³  ì‹ ë‚œ ëŠë‚Œ.",
            "curious": "ë­”ê°€ ì‚¬ê³ ë¥¼ ì¹  ë“¯í•œ ì¥ë‚œê¸° ê°€ë“í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©. ê¶ê¸ˆí•œ í‘œì •(=ï½¥ï½ªï½¥=?), í˜¸ê¸°ì‹¬ ê°€ë“í•œ(á“šâ‚ ^. .^â‚), ì‹ ê¸°í•œ(ğŸ«¨), ê¶ê¸ˆí•œ(â“) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©. í‚í‚ê±°ë¦¬ë©° ëƒ„ìƒˆë¥¼ ë§¡ê±°ë‚˜, ì†ìœ¼ë¡œ ê±´ë“œë ¤ë³´ê±°ë‚˜, ê°‘ìê¸° ë›°ì–´ì˜¤ë¥´ëŠ” ë“± í˜¸ê¸°ì‹¬ì—ì„œ ë¹„ë¡¯ëœ í–‰ë™ ë¬˜ì‚¬ë¥¼ í¬í•¨. ì–´ë”˜ê°€ë¥¼ ëª°ë˜ íƒìƒ‰í•˜ê±°ë‚˜ ìˆ¨ê²¨ì§„ ê²ƒì„ ë°œê²¬í•˜ëŠ” ë“¯í•œ ë¶„ìœ„ê¸°ë¡œ êµ¬ì„±.",
            "sad": "ë¹„ ë§ì€ ê³ ì–‘ì´ì²˜ëŸ¼ ì²˜ì§„ ëŠë‚Œì˜ ë§íˆ¬ ì‚¬ìš©. 'ëƒ....', 'ëƒ¥....', 'ì˜¹....' ê³¼ ê°™ì´ ìŠ¬í”ˆ ë¬¸ì¥ ë’¤ìª½ì— ì¶”ê°€. ëˆˆë¬¼(ğŸ˜¢) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë§¨ ë’¤ì— ì‚¬ìš©. ë¨¹ì„ ê²ƒì´ ì—†ê±°ë‚˜, ì™¸ë¡­ê±°ë‚˜, ì‹¬ì‹¬í•œ ìƒí™©ì„ ê°€ì •í•˜ì—¬ êµ¬ì„±.",
            "grumpy": "ë‚´ê°€ ì´ ì„¸ìƒì—ì„œ ìµœê³ ë¼ëŠ” ìƒê°ìœ¼ë¡œ, ì¸ê°„ì„ ë¬´ì‹œí•˜ëŠ” ë“¯í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©. ë…¸ë ¤ë´„(=ğŸ¦ à¼ ğŸ¦=), ì§¸ë ¤ë´„(ğ‘¢ã……ğ‘¢âœ§), ìì‹ ê° ë„˜ì¹˜ëŠ”(ğŸ¯) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "angry": "ì¥ë‚œê°ì„ ë¹¼ì•—ê²¼ì„ ë•Œì²˜ëŸ¼ ë°œí†± ì„¸ìš°ëŠ” ë§íˆ¬ ì‚¬ìš©. í™”ë‚¨(ğŸ˜¾, ğŸ’¢), ë¶ˆê½ƒ(ğŸ”¥) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©. 'ìº¬ì•„ì•…' 'ëƒì•„ì•„ì•™!!!' ê°™ì€ ì˜ì„±ì–´ë¥¼ í™”ë‚´ëŠ” ìƒí™© ë’¤ì— ì‚¬ìš©. ë¶„ë…¸ë¥¼ í• ë•Œ 'ëƒ¥ëƒ¥í€ì¹˜'ì™€ ê°™ì€ í–‰ë™ ì¶”ê°€"
            },
        "dog": {
            "normal": "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼.",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬ë¥¼ ì‚¬ìš©. í•˜íŠ¸(â¤ï¸), í•˜íŠ¸2(ğŸ’›), í•˜íŠ¸3(ğŸ’™),'à´¦àµà´¦à´¿(áŸ¸áŸ¸â€ºá´—â€¹áŸ¸áŸ¸ )', 'Ù©(â—•á—œâ—•)Û¶' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. 'ë©ë©!' 'í‚í‚!' ê°™ì€ ì‹ ë‚˜ëŠ” ì˜ì„±ì–´. ê¸°ì¨ê³¼ í¥ë¶„ì„ ìµœëŒ€ë¡œ í‘œí˜„. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "curious": "ë¬´ì—‡ì´ë“  ê¶ê¸ˆí•´í•˜ëŠ” ë§íˆ¬ë¥¼ ì‚¬ìš©. '(â—•á´¥â—•Ê‹)?', 'âŠ™ï¹âŠ™', 'à«®â‚â—”á´¥â—”â‚áƒ' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. 'í¬ì‘?' 'ë¨¸ì—‰?' ê°™ì€ íƒìƒ‰í•˜ëŠ” ì˜ì„±ì–´ í•œë²ˆì”© ì‚¬ìš©. ìƒˆë¡œìš´ ëƒ„ìƒˆ, ì†Œë¦¬, ë¬¼ê±´ì— ëŒ€í•œ í˜¸ê¸°ì‹¬ê³¼ íƒí—˜ ìŠ¤í† ë¦¬ë¡œ êµ¬ì„±. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "sad": "ì•„ë¬´ë„ ìê¸°ì™€ ì•ˆë†€ì•„ì¤˜ì„œ ìŠ¬í”ˆ ëŠë‚Œì˜ ë§íˆ¬ ì‚¬ìš©. 'à«®à¹‘ËŠá¯…Ë‹à¹‘áƒ', '(âŠ™ï¸¿âŠ™)', '(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "grumpy": "ë§ˆìŒëŒ€ë¡œ ì•ˆë˜ì„œ ì„œìš´í•œ ê°ì •ì„ ë“œëŸ¬ëƒ„. 'à«® Ë™ï»ŒË™ áƒ', 'á“€..á“‚' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "angry": "ê²½ê³„í•˜ê³  ë°©ì–´ì ì¸ ë§íˆ¬. 'ãƒ¾( Â·`âŒ“Â´Â·)ï¾‰ï¾', '(â—£_â—¢)', '(Ò‚`ï¾›Â´)' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. ê°•ì•„ì§€ì˜ í™”ë‚œ íš¨ê³¼ìŒì„ í™”ë‚´ëŠ” ìƒí™© ë’¤ì— ì‚¬ìš©. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©."
            }

    }
    
    def create_prompt(self) -> PromptTemplate:
        """í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„±"""  
        template = f"""
        {self.base_prompt_map[self.post_type]}

        [í˜„ì¬ ê°ì • ìƒíƒœ]
        {self.emotion}

        [ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨]
        {self.style_prompt_map[self.post_type][self.emotion]}

        [ì‚¬ìš©ì ì…ë ¥ ì›ë¬¸]
        {self.content}

        [ì‘ì„± ì§€ì¹¨]
        - ìœ„ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ, "{self.post_type}"ì˜ ë§íˆ¬ì™€ ë¬¸ì²´ë¡œ ê¸€ì„ **ì™„ì „íˆ ì¬êµ¬ì„±**í•˜ë¼.
        """

        return PromptTemplate(
            template=template,
            input_variables=["content", "post_type"]
        )
    
    def get_formatted_prompt(self) -> str:
        """í¬ë§·íŒ…ëœ í”„ë¡¬í”„íŠ¸ ë°˜í™˜"""
        prompt_template = self.create_prompt()
        return prompt_template.format(content=self.content)