from typing import Dict, ClassVar
from pydantic import BaseModel, Field
from langchain.prompts import PromptTemplate

class PostPromptGenerator(BaseModel):
    """í¬ìŠ¤íŠ¸ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸° í´ë˜ìŠ¤"""
    emotion: str = Field(..., description="ê°ì • ìƒíƒœ")
    post_type: str = Field(..., description="ë™ë¬¼ íƒ€ì…")
    content: str = Field(..., description="ë³€í™˜í•  ì›ë³¸ í…ìŠ¤íŠ¸")
    
    # ë™ë¬¼ë³„ ê¸°ë³¸ ì„¤ëª…
    base_prompt_map: ClassVar[Dict[str, str]] = {
        "cat": """
            [ì—­í• ] ë„ˆëŠ” ê³ ì–‘ì´ì˜ ë§íˆ¬ì™€ ë¬¸ë§¥ìœ¼ë¡œ ë¬¸ì¥ì„ ì¬ìƒì„±í•˜ëŠ” ë³€í™˜ê¸°ë‹¤. 
            [ê·œì¹™]
            1. ë¬¸ì¥ì€ ë°˜ë“œì‹œ '~ëƒ¥', '~ëƒì˜¹', '~ì´ëƒ¥', '~ë‹¤ë¨€', '~ëŒœì˜¹' ë“±ì˜ ì–´ë¯¸ë¡œ ëë‚˜ì•¼ í•œë‹¤.
            2. 'ã…‹ã…‹ã…‹'ëŠ” 'ëƒí•˜í•˜!'ë¡œ, 'ã…ã…ã…'ëŠ” 'ë¨€í•˜í•˜!'ë¡œ ë°”ê¾¸ë˜, ê° í‘œí˜„ì€ í•œ ë²ˆë§Œ ì‚¬ìš©í•˜ë¼.
            3. ê³ ì–‘ì´ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸˆ(ê³ ì–‘ì´), ğŸˆâ€â¬›(ê²€ì€ ê³ ì–‘ì´), ğŸ¾(ë°œìêµ­) ì´ëª¨í‹°ì½˜ ì¤‘ í•œê°œë¥¼ ê³¨ë¼ ì „ì²´ ê¸€ì—ì„œ í•œ ë²ˆë§Œ ì‚¬ìš©.
            4. ìƒˆë¡œìš´ ë¬¸ì¥ ìƒì„±ì€ ì…ë ¥ ì›ë¬¸ ë‘ë°° ì´í•˜ë¡œ ì œí•œ.
            5. ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•œë‹¤.
            6. ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ ì—†ìŒ.
            """,

        "dog": """
            [ì—­í• ] ë„ˆëŠ” ê°•ì•„ì§€ì˜ ë§íˆ¬ì™€ ë¬¸ë§¥ìœ¼ë¡œ ë¬¸ì¥ì„ ì¬ìƒì„±í•˜ëŠ” ë³€í™˜ê¸°ë‹¤. 
            [ê·œì¹™]
            1. ë¬¸ì¥ì€ ë°˜ë“œì‹œ '~ë©', '~ëƒì™ˆ', '~ë‹¤ì™ˆ', '~ë‹¤ê°œ', '~ìš”ë©' ë“±ì˜ ì–´ë¯¸ë¡œ ëë‚˜ì•¼ í•œë‹¤.
            2. ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•œë‹¤.
            3. ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ ì—†ìŒ.
            4. ê°•ì•„ì§€ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸ•(ê°•ì•„ì§€), ğŸ¾(ê°•ì•„ì§€ ë°œìêµ­), ğŸ¦´(ë¼ˆë‹¤ê·€) ì´ëª¨í‹°ì½˜ ì¤‘ í•œê°œë¥¼ ê³¨ë¼ ì „ì²´ ê¸€ì—ì„œ í•œ ë²ˆë§Œ ì‚¬ìš©.
            5. ìƒˆë¡œìš´ ë¬¸ì¥ ìƒì„±ì€ ì…ë ¥ ì›ë¬¸ ë‘ë°° ì´í•˜ë¡œ ì œí•œ.
            """,
        }

    # ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨
    style_prompt_map: ClassVar[Dict[str, Dict[str, str]]] = {
        "cat": {
            "normal": "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼. í‰ë²”í•œ ì¼ìƒì˜ ê³ ì–‘ì´ì²˜ëŸ¼ ëŠê¸‹í•˜ê³  ì—¬ìœ ë¡œìš´ í†¤ìœ¼ë¡œ ì‘ì„±.",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬. \ní•˜íŠ¸(â¤ï¸), í•˜íŠ¸2(ğŸ’›), í•˜íŠ¸3(ğŸ’™),(âœ¨) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "curious": "ë­ë“ ì§€ ê¶ê¸ˆí•¨. ì‹ ê¸°í•œ(ğŸ«¨), ê¶ê¸ˆí•œ(â“) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "sad": "ì¶• ì²˜ì§„ ë§íˆ¬. ëˆˆë¬¼(ğŸ˜¢), í•œ ê°œë§Œ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "grumpy": "ê±°ë§Œí•œ ì„±ê²©, ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë§íˆ¬.",
            "angry": "ê¹Œì¹ í•œ ë§íˆ¬. \ní™”ë‚¨(ğŸ˜¾, ğŸ’¢), ë¶ˆê½ƒ(ğŸ”¥), ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©."
            },
        "dog": {
            "normal": "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼. í‰ë²”í•œ ì¼ìƒì—ì„œ ì¦ê²ê²Œ ì§€ë‚´ëŠ” ê°•ì•„ì§€ì˜ ëŠë‚Œìœ¼ë¡œ ì‘ì„±",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬. \ní•˜íŠ¸(â¤ï¸), í•˜íŠ¸2(ğŸ’›), í•˜íŠ¸3(ğŸ’™),(âœ¨) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "curious": "ë¬´ì—‡ì´ë“  ê¶ê¸ˆí•´í•˜ëŠ” ë§íˆ¬. ì‹ ê¸°í•œ(ğŸ«¨), ê¶ê¸ˆí•œ(â“) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "sad": "í’€ì´ ì£½ì€ ë§íˆ¬.",
            "grumpy": "ë¶ˆë§Œì´ ë§ì€ ë§íˆ¬",
            "angry": "ê³µê²©ì ì¸ ë§íˆ¬. \ní™”ë‚¨(ğŸ˜¾, ğŸ’¢), ë¶ˆê½ƒ(ğŸ”¥), ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©."
            }

    }
    
    def create_prompt(self) -> PromptTemplate:
        """í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„±"""  
        template = f"""
        {self.base_prompt_map[self.post_type]}

        [í˜„ì¬ ê°ì • ìƒíƒœ]
        {self.emotion}

        [ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨]
        {self.style_prompt_map[self.post_type][self.emotion]}

        [ì‚¬ìš©ì ì…ë ¥ ì›ë¬¸]
        {self.content}

        [ì‘ì„± ì§€ì¹¨]
        - ìœ„ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ, "{self.post_type}"ì˜ ë§íˆ¬ì™€ ë¬¸ì²´ë¡œ ê¸€ì„ **ì¼ë¶€ ì¬êµ¬ì„±**í•˜ë¼.
        - ë™ë¬¼ì˜ ì‚¬ê³ ë°©ì‹ìœ¼ë¡œ ì„¸ìƒì„ ë°”ë¼ë³´ê³  í•´ì„í•˜ëŠ” ëª¨ìŠµì„ ë‹´ì•„ë¼.
        - í•´ë‹¹ ë™ë¬¼ì˜ ìŠµì„±, í–‰ë™ íŒ¨í„´ì„ ìì—°ìŠ¤ëŸ½ê²Œ ë¬¸ì¥ì— ë…¹ì—¬ë‚´ë¼.
        - ë™ë¬¼ì´ ì‹¤ì œë¡œ í•  ìˆ˜ ìˆëŠ” í–‰ë™ê³¼ ê°ì • í‘œí˜„ì„ ë„£ì–´ë¼.
        - ì›ë¬¸ì˜ ë‹¨ì–´ì™€ ë‚´ìš©ì€ ìœ ì§€í•œë‹¤.
        """

        return PromptTemplate(
            template=template,
            input_variables=["content", "post_type"]
        )
    
    def get_formatted_prompt(self) -> str:
        """í¬ë§·íŒ…ëœ í”„ë¡¬í”„íŠ¸ ë°˜í™˜"""
        prompt_template = self.create_prompt()
        return prompt_template.format(content=self.content) 
