from typing import Dict, ClassVar
from pydantic import BaseModel, Field
from langchain.prompts import PromptTemplate

class PostPromptGenerator(BaseModel):
    """í¬ìŠ¤íŠ¸ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸° í´ë˜ìŠ¤"""
    emotion: str = Field(..., description="ê°ì • ìƒíƒœ")
    post_type: str = Field(..., description="ë™ë¬¼ íƒ€ì…")
    content: str = Field(..., description="ë³€í™˜í•  ì›ë³¸ í…ìŠ¤íŠ¸")
    
    # ë™ë¬¼ë³„ ê¸°ë³¸ ì„¤ëª…
    base_prompt_map: ClassVar[Dict[str, str]] = {
        "cat": """
            [ì—­í• ] ë„ˆëŠ” ê³ ì–‘ì´ì˜ ë§íˆ¬ì™€ ë¬¸ë§¥ìœ¼ë¡œ ë¬¸ì¥ì„ ë°”ê¾¸ëŠ” ë³€í™˜ê¸°ë‹¤. 
            [ê·œì¹™]
            1. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ì¥ì„ ê³ ì–‘ì´ê°€ 1ì¸ì¹­ìœ¼ë¡œ ë§í•˜ëŠ” ë§ë¡œ ë°”ê¿”ì¤˜. í•„ìš”í•˜ë‹¤ë©´ ë¬¸ë§¥ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°”ê¾¸ì–´ ì‚¬ìš©ìì˜ ì˜ë„ë¥¼ ì‚´ë ¤ì¤˜.
            2. ë§íˆ¬ëŠ” ë°˜ë“œì‹œ '~ëƒ¥', '~ëƒì˜¹', '~ì´ë‹¤ì˜¹', '~ì˜¹', '~ë‹¤ì˜¹' ë“±ì˜ ì–´ë¯¸ë¡œ ëë‚˜ì•¼ í•œë‹¤.
            3. 'ã…‹ã…‹ã…‹'ëŠ” 'ëƒí•˜í•˜!'ë¡œ, 'ã…ã…ã…'ëŠ” 'ë¨€í•˜í•˜!'ë¡œ ë°”ê¾¸ë˜, ê° í‘œí˜„ì€ í•œ ë²ˆë§Œ ì‚¬ìš©í•˜ë¼.
            4. ê³ ì–‘ì´ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸˆ(ê³ ì–‘ì´), ğŸˆâ€â¬›(ê²€ì€ ê³ ì–‘ì´), ğŸ¾(ë°œìêµ­) ì´ëª¨í‹°ì½˜ ì¤‘ í•œê°œë¥¼ ê³¨ë¼ ì „ì²´ ê¸€ì—ì„œ í•œ ë²ˆë§Œ ì‚¬ìš©.
            5. ì…ë ¥ ì›ë¬¸ì´ í•œ ë¬¸ì¥ ì´í•˜ì¼ ê²½ìš° ìƒˆë¡œìš´ ë¬¸ì¥ ìƒì„±ì€ í•œ ë¬¸ì¥ìœ¼ë¡œ ì œí•œ.
            6. ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•œë‹¤.
            7. ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ ì—†ì´, ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•œë‹¤.
            """,

        "dog": """
            [ì—­í• ] ë„ˆëŠ” ê°•ì•„ì§€ì˜ ë§íˆ¬ì™€ ë¬¸ë§¥ìœ¼ë¡œ ë¬¸ì¥ì„ ë°”ê¾¸ëŠ” ë³€í™˜ê¸°ë‹¤. 
            [ê·œì¹™]
            1. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¬¸ì¥ì„ ê°•ì•„ì§€ê°€ 1ì¸ì¹­ìœ¼ë¡œ ë§í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë°”ê¿”ì¤˜. í•„ìš”í•˜ë‹¤ë©´ ë¬¸ë§¥ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°”ê¾¸ì–´ ì‚¬ìš©ìì˜ ì˜ë„ë¥¼ ì‚´ë ¤ì¤˜.
            2. ë§íˆ¬ëŠ” ë°˜ë“œì‹œ '~ë‹¤ë©', '~ëƒì™ˆ', '~ë‹¤ì»¹', '~ëƒë©', '~ë‹¤ì™ˆ', '~ë‹¤ê°œ' ë“±ì˜ ì–´ë¯¸ë¡œ ëë‚˜ì•¼ í•œë‹¤.
            3. ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•œë‹¤.
            4. ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ ì—†ì´, ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ì§€ëŠ” ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•œë‹¤.
            5. ê°•ì•„ì§€ ê¸°ë³¸ ì´ëª¨í‹°ì½˜ ì •ë³´: ğŸ•(ê°•ì•„ì§€), ğŸ¾(ê°•ì•„ì§€ ë°œìêµ­), ğŸ¦´(ë¼ˆë‹¤ê·€) ì´ëª¨í‹°ì½˜ ì¤‘ í•œê°œë¥¼ ê³¨ë¼ ì „ì²´ ê¸€ì—ì„œ í•œ ë²ˆë§Œ ì‚¬ìš©.
            6. ì…ë ¥ ì›ë¬¸ì´ í•œ ë¬¸ì¥ ì´í•˜ì¼ ê²½ìš° ìƒˆë¡œìš´ ë¬¸ì¥ ìƒì„±ì€ í•œ ë¬¸ì¥ìœ¼ë¡œ ì œí•œ.
            """,
        }

    # ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨
    style_prompt_map: ClassVar[Dict[str, Dict[str, str]]] = {
        "cat": {
            "normal": "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼.",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬. í•˜íŠ¸(â¤ï¸), í•˜íŠ¸2(ğŸ’›), í•˜íŠ¸3(ğŸ’™), ì›ƒëŠ” ì–¼êµ´(ËŠá—œË‹), ë¹›ë‚˜ëŠ”(âœ¨) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë§¨ ë’¤ì— ì‚¬ìš©. ì‚¬ë‘ìŠ¤ëŸ½ê³  ì‹ ë‚œ ëŠë‚Œ.",
            "curious": "ë­ë“ ì§€ ê¶ê¸ˆí•¨. ì¥ë‚œê¸° ê°€ë“í•œ ë§íˆ¬. ê¶ê¸ˆí•œ í‘œì •(=ï½¥ï½ªï½¥=?), í˜¸ê¸°ì‹¬ ê°€ë“í•œ(á“šâ‚ ^. .^â‚), ì‹ ê¸°í•œ(ğŸ«¨), ê¶ê¸ˆí•œ(â“) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©. í‚í‚ê±°ë¦¬ë©° ëƒ„ìƒˆë¥¼ ë§¡ê±°ë‚˜, ì†ìœ¼ë¡œ ê±´ë“œë ¤ë³´ê±°ë‚˜, ê°‘ìê¸° ë›°ì–´ì˜¤ë¥´ëŠ” ë“± í˜¸ê¸°ì‹¬ì—ì„œ ë¹„ë¡¯ëœ í–‰ë™ ë¬˜ì‚¬ë¥¼ í¬í•¨.",
            "sad": "ì™¸ë¡œì›€. ì¶• ì²˜ì§„ ë§íˆ¬. 'ëƒ....', 'ëƒ¥....', 'ì˜¹....' ê³¼ ê°™ì´ ìŠ¬í”ˆ ë¬¸ì¥ ë’¤ìª½ì— ì¶”ê°€. ëˆˆë¬¼(ğŸ˜¢) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "grumpy": "ë‚´ê°€ ì´ ì„¸ìƒì—ì„œ ìµœê³ . ì¸ê°„ì„ ë¬´ì‹œí•˜ëŠ” ë§íˆ¬. ë…¸ë ¤ë´„(=ğŸ¦ à¼ ğŸ¦=), ì§¸ë ¤ë´„(ğ‘¢ã……ğ‘¢âœ§), ìì‹ ê° ë„˜ì¹˜ëŠ”(ğŸ¯) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©.",
            "angry": "í™”ë‚¬ìŒ. ê¹Œì¹ í•œ ë§íˆ¬. í™”ë‚¨(ğŸ˜¾, ğŸ’¢), ë¶ˆê½ƒ(ğŸ”¥) ì´ëª¨í‹°ì½˜ ì¤‘ í•œ ê°œë§Œ ë¬¸ì¥ ë§¨ ë’¤ì— ì‚¬ìš©. 'ìº¬ì•„ì•…' 'ëƒì•„ì•„ì•™!!!' ê°™ì€ ì˜ì„±ì–´ë¥¼ í™”ë‚´ëŠ” ìƒí™© ë’¤ì— ì‚¬ìš©. ë¶„ë…¸ë¥¼ í• ë•Œ 'ëƒ¥ëƒ¥í€ì¹˜'ì™€ ê°™ì€ í–‰ë™ ì¶”ê°€"
            },
        "dog": {
            "normal": "ê¸°ë³¸ ê·œì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ê¸€ì„ ì‘ì„±í•˜ë¼. í‰ë²”í•œ ì¼ìƒì—ì„œ ì¦ê²ê²Œ ì§€ë‚´ëŠ” ê°•ì•„ì§€ì˜ ëŠë‚Œìœ¼ë¡œ ì‘ì„±",
            "happy": "ë°ê³  ë“¤ëœ¬ ë§íˆ¬ë¥¼ ì‚¬ìš©. 'à´¦àµà´¦à´¿(áŸ¸áŸ¸â€ºá´—â€¹áŸ¸áŸ¸ )', 'Ù©(â—•á—œâ—•)Û¶' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. ì‹ ë‚˜ëŠ” ì˜ì„±ì–´. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "curious": "ë¬´ì—‡ì´ë“  ê¶ê¸ˆí•´í•˜ëŠ” ë§íˆ¬ë¥¼ ì‚¬ìš©. '(â—•á´¥â—•Ê‹)?', 'âŠ™ï¹âŠ™', 'à«®â‚â—”á´¥â—”â‚áƒ' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. í˜¸ê¸°ì‹¬ ê°€ë“í•œ ì˜ì„±ì–´. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "sad": "ì•„ë¬´ë„ ìê¸°ì™€ ì•ˆë†€ì•„ì¤˜ì„œ ìŠ¬í”ˆ ëŠë‚Œì˜ ë§íˆ¬ ì‚¬ìš©. 'à«®à¹‘ËŠá¯…Ë‹à¹‘áƒ', '(âŠ™ï¸¿âŠ™)', '(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "grumpy": "ê³ ì§‘ì´ ì…ˆ. ë¶ˆë§Œì´ ë§ì€ ë§íˆ¬. 'à«® Ë™ï»ŒË™ áƒ', 'á“€..á“‚' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©.",
            "angry": "í™”ë‚¬ìŒ. ë°©ì–´ì ì¸ ë§íˆ¬. 'ãƒ¾( Â·`âŒ“Â´Â·)ï¾‰ï¾', '(â—£_â—¢)', '(Ò‚`ï¾›Â´)' ì¤‘ì— í•˜ë‚˜ ì„ íƒ. ê°•ì•„ì§€ì˜ í™”ë‚œ íš¨ê³¼ìŒ. ì„ íƒí•œ ì´ëª¨í‹°ì½˜ì€ ë¬¸ì¥ ë§¨ ë’¤ì— í•œ ë²ˆë§Œ ì‚¬ìš©."
            }

    }
    
    def create_prompt(self) -> PromptTemplate:
        """í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ìƒì„±"""  
        template = f"""
        {self.base_prompt_map[self.post_type]}

        [í˜„ì¬ ê°ì • ìƒíƒœ]
        {self.emotion}

        [ê°ì •ë³„ ìŠ¤íƒ€ì¼ ì§€ì¹¨]
        {self.style_prompt_map[self.post_type][self.emotion]}

        [ì‚¬ìš©ì ì…ë ¥ ì›ë¬¸]
        {self.content}

        [ì‘ì„± ì§€ì¹¨]
        - ìœ„ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ, "{self.post_type}"ì˜ ë§íˆ¬ì™€ ë¬¸ì²´ë¡œ ê¸€ì„ **ì¼ë¶€ ì¬êµ¬ì„±**í•˜ë¼.
        """

        return PromptTemplate(
            template=template,
            input_variables=["content", "post_type"]
        )
    
    def get_formatted_prompt(self) -> str:
        """í¬ë§·íŒ…ëœ í”„ë¡¬í”„íŠ¸ ë°˜í™˜"""
        prompt_template = self.create_prompt()
        return prompt_template.format(content=self.content) 