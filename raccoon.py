import re

def raccoon_converter(text):
    """í…ìŠ¤íŠ¸ë¥¼ ë„ˆêµ´ì²´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜"""
    if not text or not isinstance(text, str):
        return text
    
    result = text

       
    # ì˜ì–´ ë¬¸ì¥ ì²´í¬ (ì•ŒíŒŒë²³, ê³µë°±, ìˆ«ì, ê¸°ë³¸ ë¬¸ì¥ë¶€í˜¸ë§Œ í¬í•¨)
    if re.match(r'^[a-zA-Z\s\d.,!?;:\'"-]+$', result.strip()):
        # ë¬¸ì¥ ëì— ë¬¸ì¥ë¶€í˜¸ê°€ ìˆëŠ” ê²½ìš° ì•ì— meow ì¶”ê°€
        if re.search(r'[.!?]$', result.strip()):
            result = re.sub(r'([.!?])$', r' meow\1', result.strip())
        else:
            # ë¬¸ì¥ë¶€í˜¸ê°€ ì—†ëŠ” ê²½ìš° ê·¸ëƒ¥ meow ì¶”ê°€
            result = result.strip() + ' meow'
        return result

    # 0. ì‘ì€ë”°ì˜´í‘œ ì•ˆì˜ ë‚´ìš© ë³´í˜¸
    quoted_parts = {}
    quote_pattern = r"'([^']*?)'"
    
    def replace_quoted(match):
        placeholder = f"TEMP_QUOTE_{len(quoted_parts)}"
        quoted_parts[placeholder] = match.group(0)
        return placeholder
    
    result = re.sub(quote_pattern, replace_quoted, result)
    
    # 1. "ì•„ì•„" ë³´í˜¸ (ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸, ì˜ì„±ì–´)
    result = re.sub(r'ì•„ì•„', 'TEMP_AA', result)
    
    # 2. "ì•ˆë…•" â†’ "êµ´í•˜" ë³€í™˜
    result = re.sub(r'ì•ˆë…•', 'êµ¬ë¦¬êµ¬ë¦¬ì•ˆë…•êµ¬ë¦¬', result)
    # 3. "í•˜ì´" â†’ "ëƒ¥í•˜" ë³€í™˜ (ìƒˆë¡œ ì¶”ê°€)
    result = re.sub(r'í•˜ì´', 'êµ¬ë¦¬êµ¬ë¦¬í•˜ì´êµ¬ë¦¬', result)
    result = re.sub(r'ë°”ì´', 'êµ¬ë¦¬êµ¬ë¦¬ë°”ì´êµ¬ë¦¬', result)
    result = re.sub(r'ë¹ ì´', 'êµ¬ë¦¬êµ¬ë¦¬ë¹ ì´êµ¬ë¦¬', result)    


    result = re.sub(r'ì‚¬ëŒë“¤', 'ë„ˆêµ´ë“¤', result)

    result = re.sub(r'ì‚¬ëŒì´', 'ë„ˆêµ¬ë¦¬ê°€', result)  # "ì‚¬ëŒ" â†’ "ë„ˆêµ´ì´ê°€"
    result = re.sub(r'ì‚¬ëŒì„', 'ë„ˆêµ¬ë¦¬ë¥¼', result)  # "ì‚¬ëŒì€" â†’ "ë„ˆêµ¬ë¦¬ë¥¼"
    result = re.sub(r'ì‚¬ëŒì´ì•¼', 'ë„ˆêµ¬ë¦¬ì–', result)  # "ì‚¬ëŒì´ì•¼" â†’ "ë„ˆêµ¬ë¦¬ì–"
    result = re.sub(r'(ë‚˜ëŠ”|ë‚œ)\s*(\S+?)ì•¼', 'ë‚˜ëŠ” ë„ˆêµ¬ë¦¬ì–', result)  # "ë‚˜ëŠ” [í•œê¸€]ì•¼" â†’ "ë‚˜ëŠ” ë„ˆêµ¬ë¦¬ì–"
    result = re.sub(r'(ë‚˜ëŠ”|ë‚œ)\s*(\S+?)ë‹¤[ê°€-í£]?', 'ë‚˜ëŠ” ë„ˆêµ¬ë¦¬ë‹·', result)
    result = re.sub(r'ë„ˆêµ¬ë¦¬', r'ë„ˆêµ¬ë¦¬ğŸ¦', result)  # "ë„ˆêµ¬ë¦¬" â†’ "ë„ˆêµ¬ë¦¬ğŸ¦"
    result = re.sub(r'([ê°€-í£])ì•¼(?=\s|$|[!?.,])', r'\1ì–', result) # "ì•¼" â†’ "ì–Œ"

    result = re.sub(r'ì¡¸ë¦¬ë‹¤', 'ì¡¸ë¦¬êµ¬ë¦¬..', result)
    result = re.sub(r'ì ì˜¨ë‹¤', 'ì ì˜¤ëŠ”êµ¬ë¦¬..', result)

    # ë°°ê³ í”” í‘œí˜„
 
    result = re.sub(r'ë°°ê³ íŒŒìš”?', 'ë°°ê³ í”„êµ¬ë¦¬...', result)
    result = re.sub(r'ë°°ê³ í”„ë‹¤', 'ë°°ê³ í”„êµ¬ë¦¬...', result)
    

    # ìŠ¬í”” í‘œí˜„  
    result = re.sub(r'ìŠ¬í¼', 'ìŠ¬í”„êµ¬ë¦¬...', result)
    result = re.sub(r'ìŠ¬í”„ë‹¤', 'ìŠ¬í”„êµ¬ë¦¬...', result)

    # ì‹¬ì‹¬í•¨ í‘œí˜„
    result = re.sub(r'ì‹¬ì‹¬í•´', 'ì‹¬ì‹¬í•˜êµ¬ë¦¬...', result)
    result = re.sub(r'ì‹¬ì‹¬í•˜ë‹¤', 'ì‹¬ì‹¬í•˜êµ¬ë¦¬...', result)

    result = re.sub(r'ëƒ(ë©|ê°œ|ì˜¹|ì™ˆ|ì®¸|ì°|ëª½|ë¼ë¼)', 'ëƒêµ¬ë¦¬', result)
    result = re.sub(r'ë‹¤(ì˜¹|ë©|ê°œ|ì™ˆ|ëƒ¥|ì®¸|ì°|ëª½|ë¼ë¼)', 'ë‹¤êµ´', result)
    result = re.sub(r'ë‹¤\b', 'ë‹¤êµ´', result)
    result = re.sub(r'ìš”\b', 'ìš”êµ¬ë¦¬', result)

    # 5. ëŒ€ë‹µ ë³€í™˜: "ì‘" â†’ "ì›…", "ë„¤" â†’ "ë„¹", "ì˜ˆ" â†’ "ë…±" (ì œí•œì )
    result = re.sub(r'^ì‘(?=[!?\s.,]|$)', 'ì›…', result)
    result = re.sub(r'(\s)ì‘(?=[!?\s.,]|$)', r'\1ì›…', result)
    # "ë„¤"ëŠ” ëª…í™•í•œ ëŒ€ë‹µì¼ ë•Œë§Œ ë³€í™˜ (ë¬¸ì¥ë¶€í˜¸ì™€ í•¨ê»˜)
    result = re.sub(r'^ë„¤([!?.,])', r'ë„¹\1', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'^ë„¤(?=\s*$)', 'ë„¹', result)  # ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    result = re.sub(r'(\s)ë„¤([!?.,])', r'\1ë„¹\2', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'(\s)ë„¤(?=\s*$)', r'\1ë„¹', result)  # ì¤‘ê°„ì— ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    # "ì˜ˆ"ëŠ” ëª…í™•í•œ ëŒ€ë‹µì¼ ë•Œë§Œ ë³€í™˜ (ë¬¸ì¥ë¶€í˜¸ì™€ í•¨ê»˜)
    result = re.sub(r'^ì˜ˆ([!?.,])', r'ë…±\1', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'^ì˜ˆ(?=\s*$)', 'ë…±', result)  # ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    result = re.sub(r'(\s)ì˜ˆ([!?.,])', r'\1ë…±\2', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'(\s)ì˜ˆ(?=\s*$)', r'\1ë…±', result)  # ì¤‘ê°„ì— ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    

    # 6. ê°íƒ„ì‚¬ ë³€í™˜: ë¬¸ì¥ ë§¨ ì•ì˜ ê°íƒ„ì‚¬ ë³€í™˜ (ë¬¸ì¥ ë ì²˜ë¦¬ ì „ì— ì‹¤í–‰)
    result = re.sub(r'^ì™€(?=\s|$|[.!?,:;~])', 'í›„ì•™', result)
    result = re.sub(r'^ì˜¤(?=\s|$|[.!?,:;~])', 'í˜¸ì˜¤', result)
    result = re.sub(r'^ì•„(?=\s|$|[.!?,:;~])', 'í›„ì•„', result)

        # 7. ê°íƒ„ì‚¬ ë³€í™˜ (ì•—, ì•™, ìœ¼ì•…, ì•„ì•…) - ìœ„ì¹˜ì— ê´€ê³„ì—†ì´ ëª¨ë‘ ë³€í™˜
    result = re.sub(r'(?<![ê°€-í£])ì•™(?![ê°€-í£])', 'í›„ì•™', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ì•—(?![ê°€-í£])', 'í›„ì•—', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ìœ¼ì•…(?![ê°€-í£])', 'í›„ì•…', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ì•„ì•…(?![ê°€-í£])', 'íì•…', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°

        # 8. ììŒ ì¡°í•© ë³€í™˜ (ê¸´ íŒ¨í„´ë¶€í„° ë¨¼ì € ì²˜ë¦¬)
    result = re.sub(r'(ã…ã…‡ã…Œ|í™”ì´íŒ…|íŒŒì´íŒ…)', 'ë„ˆêµ´íŒ…', result)  # ã…ã…‡ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬
    result = re.sub(r'ã…ã…‡', 'êµ¬ë¦¬êµ¬ë¦¬í•˜ì´êµ¬ë¦¬!', result)
    result = re.sub(r'ã…‡ã…', 'ì–´ë¨¸ë„ˆêµ´', result)
    result = re.sub(r'ã…ã…‡', 'ëª¨ì•¼ë„ˆêµ´', result)
    result = re.sub(r'(ã„±ã…Š|ê´œì°®)', 'ê´œì°®ë„ˆêµ´', result)
    result = re.sub(r'ã…‹ã…‹+', r'\g<0>êµ´í•˜í•˜', result)
    result = re.sub(r'ã…ã…+', r'\g<0>í—¤í—¤í—·~', result)
    result = re.sub(r'ã…œ+', 'êµ´êµ´..', result)

    result = re.sub(r'ã„±ã„±', 'ê³ ê³ ë„ˆêµ´!', result)
    result = re.sub(r'ã……ã„±', 'ìˆ˜ê³ í•´ë¼ë„ˆêµ´~', result)

    #ë¯¸ì•¼ì˜¹ ì´ìŠ¤í„°ì—ê·¸
    result = re.sub(r'ë¯¸ì•¼ì˜¹ì¦ˆ', 'âœ¨ë¯¸ì•¼ì˜¹ì¦ˆâœ¨', result)
    result = re.sub(r'ë¯¸ì•¼ì˜¹', 'âœ¨ë¯¸ì•¼ì˜¹âœ¨', result)
    result = re.sub('í•´ë³´', 'í•´ë³´(ë°”ë³´)ğŸˆ', result)
    result = re.sub('ì†Œí”¼', 'ì†Œí”¼ğŸ€', result)


        # ã„±ã…‡ã…‡ë¥¼ ì„ì‹œë¡œ ë³´í˜¸
    result = re.sub(r'ã„±ã…‡ã…‡', 'TEMP_GYY', result)
    # ã…‡ã…‡ ë³€í™˜
    result = re.sub(r'ã…‡ã…‡', 'ì›…êµ¬ë¦¬', result)
    result = re.sub(r'(ã…‡ã„¸|ì–´ë•Œ|ì–´ë–°|ì–´ë—˜|ì–´ë•¡)', 'êµ¬ë¦¬êµ¬ë¦¬ ì–´ë–»êµ¬ë¦¬', result)
    result = re.sub(r'(?<![ê°€-í£])ì•„í•˜(?![ê°€-í£])', 'êµ¬ë¦¬êµ¬ë¦¬ ì•„í•˜êµ¬ë¦¬', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ë…ë¦½ëœ "ì•„í•˜"ë§Œ

    # 10. ë¬¸ì¥ ëì— "ë„ˆêµ´" ì¶”ê°€ (í•œêµ­ì–´ê°€ í¬í•¨ëœ ê²½ìš°ë§Œ)
    if re.search(r'[ê°€-í£]', result):
        # ë¬¸ì¥ ë ì²˜ë¦¬ - ë¬¸ì¥ë¶€í˜¸ë¡œ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<!ë„ˆêµ´)(\s*[.!?~\\;]+)(?![ê°€-í£])', r'\1ë„ˆêµ´\2', result)

        
        # ì´ëª¨í‹°ì½˜ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<!ë„ˆêµ´)(\s*\^\^\s*$)', r'\1ë„ˆêµ´\2', result)  # ^^ ì´ëª¨í‹°ì½˜
        result = re.sub(r'([ê°€-í£])(?<!ë„ˆêµ´)(\s*:\)\s*$)', r'\1ë„ˆêµ´\2', result)  # :) ì´ëª¨í‹°ì½˜
        result = re.sub(r'([ê°€-í£])(?<!ë„ˆêµ´)(\s*[\U0001F600-\U0001F64F\U0001F300-\U0001F5FF\U0001F680-\U0001F6FF\U0001F1E0-\U0001F1FF\u2600-\u26FF\u2700-\u27BF]+\s*$)', r'\1ë„ˆêµ´\2', result)  # ìœ ë‹ˆì½”ë“œ ì´ëª¨í‹°ì½˜
        
        # ììŒ/ëª¨ìŒ(ã…‹ã…‹, ã…ã…, ã…‡ã…‹ ë“±) ì•ì˜ í•œê¸€ì— "ì°" ì¶”ê°€
        result = re.sub(r'([ê°€-í£])(?<!ì°)(\s*[ã„±-ã…ã…-ã…£ã…‹ã…ã…‡ã…‹]+)', r'\1ë„ˆêµ´\2', result)  # ììŒ/ëª¨ìŒ ì•
        
        # ì¤„ë°”ê¿ˆ ì²˜ë¦¬
        result = re.sub(r'([ê°€-í£])(?<!ì°)(\s*\r?\n)', r'\1ë„ˆêµ´\2', result)  # ì¤„ë°”ê¿ˆìœ¼ë¡œ ë
        
        # ë¬¸ì¥ë¶€í˜¸ ì—†ì´ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<!ì°)(\s*$)', r'\1ë„ˆêµ´\2', result)  # ê·¸ëƒ¥ ëë‚˜ëŠ” ê²½ìš°
    
    
    # 12. ë¶ˆí•„ìš”í•œ "ë„ˆêµ´" ì œê±° (íŠ¹ë³„ ë³€í™˜ í›„ ë¶™ì€ ë„ˆêµ´ ì •ë¦¬)
    # ë‹¨ì¼ íŒ¨í„´ ë’¤ì˜ ë„ˆêµ´ ì œê±°
    result = re.sub(r'(í›„ì•™|í˜¸ì˜¤|êµ¬ë¦¬|êµ´|ë¯¸ì•¼ì˜¹|ë¯¸ì•¼ì˜¹ì¦ˆ|êµ´í•˜í•˜)ë„ˆêµ´', r'\1', result)
    

    result = re.sub(r'TEMP_AA', 'ì•„ì•„', result)
        # 13. ì‘ì€ë”°ì˜´í‘œ ì•ˆì˜ ë‚´ìš© ë³µì›
    for placeholder, original in quoted_parts.items():
        result = result.replace(placeholder, original)

    return result
    